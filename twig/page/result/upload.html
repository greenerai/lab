{#
	Upload a bunch of COA files
#}

{% extends "layout/html.html" %}

{% block body %}

<style>
.upload-drop-zone {
	border: 4px inset #999;
	height: 400px;
	margin: 0 auto;
	position: relative;
	width: 800px;
}
.upload-drop-zone.active {
	background: #ccc;
	border: 4px inset #090;
}
.upload-drop-hint {
	position: absolute;
	text-align:center;
	top: 20%;
	width: 100%;
}
</style>


<div class="container mt-4" style="min-height: 70vh;">
<h1>{{ Page.title }}</h1>


<div class="upload-drop-zone">

	<div class="upload-drop-hint">
		<h2>Drop Files Here</h2>
		<p>One or more files can be dropped here to begin upload</p>
	</div>

	<div class="progress">
		<div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">0%</div>
	</div>

</div>


</div>
{% endblock %}

{% block foot_script %}
{{ parent() }}
<script>
function upload_file_list(file_list)
{
	var fd = new FormData();
	for (var i = 0; i < file_list.length; i++) {
		fd.append('file_' + i, file_list[i]);
	}

	$.ajax({
		type: 'POST',
		url: '/result/upload',
		data: fd,
		processData: false,
		contentType: false,
		success: function(data) {
			debugger;
			// $('#result').html(data); // Display images thumbnail as result
			$('.upload-drop-zone').removeClass('active');
			$('.progress-bar').attr('style', 'width: 100%').attr('aria-valuenow', '100').text('100%');
		},
		xhrFields: {
			onprogress: function (e) {
				if (e.lengthComputable) {
					var pct = e.loaded / e.total * 100;
					$('.progress-bar').attr('style', 'width: ' + pct + '%').attr('aria-valuenow', pct).text(pct + '%');
				}
			}
		},
	});
}

$(function() {

	$('.upload-drop-zone').on('dragover', function(e) {
		$(this).addClass('active'); // If drag over the window, we change the class of the #dock div by "dock_hover"
		return false;
	});

	$('.upload-drop-zone').on('dragleave', function(e) {
		$(this).removeClass('active');
	});

	$('.upload-drop-zone').on('drop', function(e) {

		if (!e.originalEvent) {
			return false;
		}
		if (!e.originalEvent.dataTransfer) {
			return false;
		}
		if (!e.originalEvent.dataTransfer.files) {
			return false;
		}

		var data = e.originalEvent.dataTransfer;
		upload_file_list(data.files);
		// var idx = 0;
		// var max = data.files.length;
		//
		// for (idx = 0; idx<max; idx++) {
		//
		// 	var f = data.files[idx];
		//
		// 	debugger;
		//
		// }

		return false;

	});

});



</script>
{% endblock %}
